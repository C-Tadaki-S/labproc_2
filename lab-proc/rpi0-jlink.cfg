
# Interface configuration for J-Link
adapter driver jlink

# J-Link specific settings (adjust as needed)
jlink usb 0x1366
jlink device Cortex-A7
jlink speed 1000

# BCM2835 specific setup
set _CHIPNAME bcm2835
set _CPUTAPID 0x07b7617F

# JTAG setup
jtag newtap $_CHIPNAME cpu -irlen 5 -ircapture 0x1 -irmask 0xf -expected-id $_CPUTAPID

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME arm11 -chain-position $_TARGETNAME

# BCM2835 memory map - critical for proper debugging
$_TARGETNAME configure -work-area-phys 0x00000000 -work-area-size 0x10000 -work-area-backup 0


$_TARGETNAME configure -event reset-assert-post {
    halt
    arm11 dbginit
}

# Additional memory regions (BCM2835 specific)
$_TARGETNAME configure -event gdb-attach {
    # Set up proper memory access
    halt
    after 100
    arm11 memwrite error_fatal disable
    arm11 memwrite burst disable
}
